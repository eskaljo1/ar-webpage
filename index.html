<!DOCTYPE html>
<html>
    <head>
        <title>DIGI.BA - AR</title>
        <link rel="icon" type="image/x-icon" href="digi.ico">
      </head>

    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@2.2.2/aframe/build/aframe-ar.min.js"></script>   
    <script>
        AFRAME.registerComponent('vidhandler', {
            init: function() {
                this.toggle = false;
                this.vid = document.querySelector("#vid");
                this.showreel = document.querySelector("#showreel");
                this.vid.pause();
            },
            tick: function() {
                if (this.el.object3D.visible == true) {
                    if (!this.toggle) {
                        if(document.querySelector('#vidId').object3D.visible == true) {
                            this.toggle = true;
                            this.vid.play();
                        } else if(document.querySelector('#showreelId').object3D.visible == true) {
                            this.toggle = true;
                            this.showreel.play();
                        }
                    }
                } else {
                    this.toggle = false;
                    this.vid.pause();
                    this.showreel.pause();
                }
            }
        });
    </script>

    <body style="margin: 8px; overflow: hidden;">    
        <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;' vr-mode-ui="enabled: false">
            <a-assets>
                <video preload="auto" id="vid" poster="digi.png" response-type="arraybuffer" loop="false" crossorigin webkit-playsinline playsinline controls>
                    <source src="video2.webm">
                    <img src="digi.png"> Your browser does not support this.
                </video>
                <video preload="auto" id="showreel" poster="digi.png" response-type="arraybuffer" loop="false" crossorigin webkit-playsinline playsinline controls>
                    <source  src="digi.mp4">
                    <img src="digi.png"> Your browser does not support this.
                </video>
            </a-assets>
            <a-marker id="memarker" type="pattern" url="marker2.patt" vidhandler >
                <a-entity id="vidId"> 
                    <a-plane position='0 1 0' scale="4 3 3" rotation="-20 0 0" material='transparent:true;src:#vid' controls></a-plane>
                </a-entity>
                <a-entity id="showreelId"  visible="false">    
                    <a-plane position='0 0 0' scale="4 2 1" rotation="-90 0 0" material='src:#showreel' controls></a-plane>
                </a-entity>
            </a-marker>
            <a-entity camera>
        </a-scene>
    </body>
    <script>
        document.querySelector('#vid').addEventListener('ended', function() {
            this.showreel = document.querySelector("#showreel");
            showreel.play();
            document.getElementById("showreelId").object3D.visible = true;
            document.querySelector('#vidId').object3D.visible = false;
        });
        document.querySelector('#showreel').addEventListener('ended', function() {
            document.getElementById("showreelId").object3D.visible = false;
        });
    </script>
</html>

